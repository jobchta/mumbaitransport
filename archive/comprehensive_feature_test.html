<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Feature Testing - Mumbai Transport</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        .content {
            padding: 30px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #0ea5e9;
        }
        .test-section h3 {
            margin: 0 0 20px 0;
            color: #1f2937;
            font-size: 1.4rem;
            font-weight: 600;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        .test-card h4 {
            margin: 0 0 15px 0;
            color: #374151;
            font-size: 1.1rem;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 500;
            border-left: 4px solid;
        }
        .pass { 
            background: #d1fae5; 
            color: #065f46; 
            border-left-color: #10b981;
        }
        .fail { 
            background: #fee2e2; 
            color: #991b1b; 
            border-left-color: #ef4444;
        }
        .warning { 
            background: #fef3c7; 
            color: #92400e; 
            border-left-color: #f59e0b;
        }
        .info { 
            background: #dbeafe; 
            color: #1e40af; 
            border-left-color: #3b82f6;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #0ea5e9);
            transition: width 0.3s ease;
        }
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(14, 165, 233, 0.3);
        }
        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }
        .btn-secondary:hover {
            background: #e5e7eb;
        }
        .live-preview {
            background: #1f2937;
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
        }
        .live-preview h3 {
            color: white;
            margin: 0 0 15px 0;
        }
        iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 8px;
            background: white;
        }
        .feature-score {
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
            margin: 15px 0;
            background: linear-gradient(135deg, #10b981, #0ea5e9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .detailed-results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .test-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .metric {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0ea5e9;
        }
        .metric-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî¨ Comprehensive Feature Testing</h1>
            <p>In-depth analysis of Mumbai Transport website functionality</p>
        </div>
        
        <div class="content">
            <div class="feature-score" id="overall-score">--</div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="runAllTests()">Run All Tests</button>
                <button class="btn btn-secondary" onclick="testTabNavigation()">Test Tab Navigation</button>
                <button class="btn btn-secondary" onclick="testRoutePlanning()">Test Route Planning</button>
                <button class="btn btn-secondary" onclick="testPWAFeatures()">Test PWA Features</button>
                <button class="btn btn-secondary" onclick="testPerformance()">Test Performance</button>
                <button class="btn btn-secondary" onclick="testAccessibility()">Test Accessibility</button>
            </div>

            <!-- Tab Navigation Testing -->
            <div class="test-section">
                <h3>üéØ Tab Navigation System</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>CSS-Only Navigation</h4>
                        <div id="css-nav-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="css-nav-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Radio Button States</h4>
                        <div id="radio-states-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="radio-states-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Visual Feedback</h4>
                        <div id="visual-feedback-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="visual-feedback-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="detailed-results" id="tab-nav-details"></div>
            </div>

            <!-- Route Planning Testing -->
            <div class="test-section">
                <h3>üó∫Ô∏è Route Planning System</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Form Elements</h4>
                        <div id="form-elements-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="form-elements-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Map Integration</h4>
                        <div id="map-integration-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="map-integration-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Data Integration</h4>
                        <div id="data-integration-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="data-integration-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="detailed-results" id="route-planning-details"></div>
            </div>

            <!-- PWA Features Testing -->
            <div class="test-section">
                <h3>üì± PWA Features</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>Service Worker</h4>
                        <div id="service-worker-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="service-worker-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Manifest</h4>
                        <div id="manifest-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="manifest-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Install Prompt</h4>
                        <div id="install-prompt-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="install-prompt-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="detailed-results" id="pwa-details"></div>
            </div>

            <!-- Performance Testing -->
            <div class="test-section">
                <h3>‚ö° Performance Analysis</h3>
                <div class="test-metrics">
                    <div class="metric">
                        <div class="metric-value" id="load-time">--</div>
                        <div class="metric-label">Load Time</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="file-size">--</div>
                        <div class="metric-label">Total Size</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="resource-count">--</div>
                        <div class="metric-label">Resources</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="css-rules">--</div>
                        <div class="metric-label">CSS Rules</div>
                    </div>
                </div>
                <div class="detailed-results" id="performance-details"></div>
            </div>

            <!-- Accessibility Testing -->
            <div class="test-section">
                <h3>‚ôø Accessibility Features</h3>
                <div class="test-grid">
                    <div class="test-card">
                        <h4>ARIA Labels</h4>
                        <div id="aria-labels-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="aria-labels-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Keyboard Navigation</h4>
                        <div id="keyboard-nav-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="keyboard-nav-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="test-card">
                        <h4>Color Contrast</h4>
                        <div id="color-contrast-results"></div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="color-contrast-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                <div class="detailed-results" id="accessibility-details"></div>
            </div>

            <div class="live-preview">
                <h3>üéØ Live Website Preview</h3>
                <iframe id="website-preview" src="http://localhost:8000/index.html"></iframe>
            </div>
        </div>
    </div>

    <script>
        let testResults = {};
        let detailedLogs = {};

        function addTestResult(section, testName, status, message, details = '') {
            if (!testResults[section]) testResults[section] = {};
            if (!detailedLogs[section]) detailedLogs[section] = [];
            
            testResults[section][testName] = { status, message };
            detailedLogs[section].push(`[${new Date().toLocaleTimeString()}] ${testName}: ${message}`);
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            
            const container = document.getElementById(`${section}-results`);
            if (container) {
                container.appendChild(resultDiv);
            }
            
            // Update detailed logs
            const detailsContainer = document.getElementById(`${section}-details`);
            if (detailsContainer) {
                detailsContainer.innerHTML = detailedLogs[section].join('\n');
            }
            
            console.log(`[${status.toUpperCase()}] ${section} - ${testName}: ${message}`);
        }

        function updateProgress(section, percentage) {
            const progressBar = document.getElementById(`${section}-progress`);
            if (progressBar) {
                progressBar.style.width = `${percentage}%`;
            }
        }

        // Tab Navigation Testing
        async function testTabNavigation() {
            console.log('üß™ Testing Tab Navigation...');
            
            const frame = document.getElementById('website-preview');
            const frameDoc = frame.contentDocument || frame.contentWindow.document;
            
            // Wait for frame to load
            await new Promise(resolve => {
                if (frameDoc.readyState === 'complete') {
                    resolve();
                } else {
                    frame.addEventListener('load', resolve);
                }
            });

            // Test 1: CSS-Only Navigation
            let cssNavScore = 0;
            
            // Check radio buttons
            const radioButtons = frameDoc.querySelectorAll('input[type="radio"][name="tabs"]');
            if (radioButtons.length >= 3) {
                addTestResult('css-nav', 'Radio Buttons', 'pass', `Found ${radioButtons.length} radio buttons`);
                cssNavScore += 25;
            } else {
                addTestResult('css-nav', 'Radio Buttons', 'fail', `Expected 3 radio buttons, found ${radioButtons.length}`);
            }
            
            // Check tab content
            const tabContent = frameDoc.querySelectorAll('.tab-content');
            if (tabContent.length >= 3) {
                addTestResult('css-nav', 'Tab Content', 'pass', `Found ${tabContent.length} tab content sections`);
                cssNavScore += 25;
            } else {
                addTestResult('css-nav', 'Tab Content', 'fail', `Expected 3 tab content sections, found ${tabContent.length}`);
            }
            
            // Test CSS selectors
            const planRadio = frameDoc.getElementById('plan-radio');
            const planTab = frameDoc.getElementById('plan-tab');
            if (planRadio && planTab) {
                planRadio.checked = true;
                planRadio.dispatchEvent(new Event('change'));
                
                setTimeout(() => {
                    if (planTab.style.display === 'block' || planTab.offsetParent !== null) {
                        addTestResult('css-nav', 'CSS Selectors', 'pass', 'CSS selectors working correctly');
                        cssNavScore += 25;
                    } else {
                        addTestResult('css-nav', 'CSS Selectors', 'fail', 'CSS selectors not working');
                    }
                }, 100);
            }
            
            // Test tab switching
            const ticketsRadio = frameDoc.getElementById('tickets-radio');
            const ticketsTab = frameDoc.getElementById('tickets-tab');
            if (ticketsRadio && ticketsTab) {
                ticketsRadio.checked = true;
                ticketsRadio.dispatchEvent(new Event('change'));
                
                setTimeout(() => {
                    if (ticketsTab.style.display === 'block' || ticketsTab.offsetParent !== null) {
                        addTestResult('css-nav', 'Tab Switching', 'pass', 'Tab switching working correctly');
                        cssNavScore += 25;
                    } else {
                        addTestResult('css-nav', 'Tab Switching', 'fail', 'Tab switching not working');
                    }
                }, 100);
            }
            
            updateProgress('css-nav', cssNavScore);

            // Test 2: Radio Button States
            let radioStatesScore = 0;
            
            // Test default state
            if (planRadio && planRadio.checked) {
                addTestResult('radio-states', 'Default State', 'pass', 'Plan tab selected by default');
                radioStatesScore += 33;
            } else {
                addTestResult('radio-states', 'Default State', 'fail', 'Plan tab not selected by default');
            }
            
            // Test state changes
            if (ticketsRadio) {
                ticketsRadio.checked = true;
                if (ticketsRadio.checked && !planRadio.checked) {
                    addTestResult('radio-states', 'State Changes', 'pass', 'Radio button states changing correctly');
                    radioStatesScore += 33;
                } else {
                    addTestResult('radio-states', 'State Changes', 'fail', 'Radio button states not changing correctly');
                }
            }
            
            // Test mutual exclusivity
            if (planRadio && ticketsRadio && compareRadio) {
                planRadio.checked = true;
                if (planRadio.checked && !ticketsRadio.checked && !compareRadio.checked) {
                    addTestResult('radio-states', 'Mutual Exclusivity', 'pass', 'Only one radio button can be selected');
                    radioStatesScore += 34;
                } else {
                    addTestResult('radio-states', 'Mutual Exclusivity', 'fail', 'Multiple radio buttons can be selected');
                }
            }
            
            updateProgress('radio-states', radioStatesScore);

            // Test 3: Visual Feedback
            let visualFeedbackScore = 0;
            
            // Test active states
            const tabButtons = frameDoc.querySelectorAll('.tab-button');
            if (tabButtons.length >= 3) {
                addTestResult('visual-feedback', 'Tab Buttons', 'pass', `Found ${tabButtons.length} tab buttons`);
                visualFeedbackScore += 50;
            } else {
                addTestResult('visual-feedback', 'Tab Buttons', 'fail', `Expected 3 tab buttons, found ${tabButtons.length}`);
            }
            
            // Test hover states (simulate)
            if (tabButtons.length > 0) {
                const firstButton = tabButtons[0];
                const originalColor = getComputedStyle(firstButton).color;
                
                // Simulate hover
                firstButton.dispatchEvent(new MouseEvent('mouseenter'));
                
                setTimeout(() => {
                    const hoverColor = getComputedStyle(firstButton).color;
                    if (hoverColor !== originalColor) {
                        addTestResult('visual-feedback', 'Hover Effects', 'pass', 'Hover effects working');
                        visualFeedbackScore += 50;
                    } else {
                        addTestResult('visual-feedback', 'Hover Effects', 'warning', 'Hover effects not detected');
                        visualFeedbackScore += 25;
                    }
                }, 100);
            }
            
            updateProgress('visual-feedback', visualFeedbackScore);
        }

        // Route Planning Testing
        async function testRoutePlanning() {
            console.log('üó∫Ô∏è Testing Route Planning...');
            
            const frame = document.getElementById('website-preview');
            const frameDoc = frame.contentDocument || frame.contentWindow.document;
            
            // Test 1: Form Elements
            let formElementsScore = 0;
            
            const fromInput = frameDoc.getElementById('from');
            const toInput = frameDoc.getElementById('to');
            const findRoutesBtn = frameDoc.querySelector('button[type="submit"]');
            
            if (fromInput && toInput) {
                addTestResult('form-elements', 'Input Fields', 'pass', 'From and To input fields found');
                formElementsScore += 50;
                
                // Test input functionality
                fromInput.value = 'Mumbai Central';
                toInput.value = 'Bandra';
                
                if (fromInput.value === 'Mumbai Central' && toInput.value === 'Bandra') {
                    addTestResult('form-elements', 'Input Functionality', 'pass', 'Input fields accept values');
                    formElementsScore += 50;
                } else {
                    addTestResult('form-elements', 'Input Functionality', 'fail', 'Input fields not accepting values');
                }
            } else {
                addTestResult('form-elements', 'Input Fields', 'fail', 'Required input fields missing');
            }
            
            updateProgress('form-elements', formElementsScore);

            // Test 2: Map Integration
            let mapIntegrationScore = 0;
            
            const mapContainer = frameDoc.getElementById('map');
            if (mapContainer) {
                addTestResult('map-integration', 'Map Container', 'pass', 'Map container found');
                mapIntegrationScore += 50;
                
                // Check if Google Maps is loaded
                if (typeof frame.contentWindow.google !== 'undefined') {
                    addTestResult('map-integration', 'Google Maps API', 'pass', 'Google Maps API loaded');
                    mapIntegrationScore += 50;
                } else {
                    addTestResult('map-integration', 'Google Maps API', 'warning', 'Google Maps API not detected');
                    mapIntegrationScore += 25;
                }
            } else {
                addTestResult('map-integration', 'Map Container', 'fail', 'Map container not found');
            }
            
            updateProgress('map-integration', mapIntegrationScore);

            // Test 3: Data Integration
            let dataIntegrationScore = 0;
            
            // Check if real data file is loaded
            try {
                const response = await fetch('http://localhost:8000/real_mumbai_transport_data.js');
                if (response.ok) {
                    addTestResult('data-integration', 'Data File', 'pass', 'Real Mumbai transport data file found');
                    dataIntegrationScore += 50;
                } else {
                    addTestResult('data-integration', 'Data File', 'warning', 'Real data file not found, using fallback');
                    dataIntegrationScore += 25;
                }
            } catch (error) {
                addTestResult('data-integration', 'Data File', 'warning', 'Data file not accessible');
                dataIntegrationScore += 25;
            }
            
            // Check if working route planner exists
            try {
                const response = await fetch('http://localhost:8000/working_route_planner.html');
                if (response.ok) {
                    addTestResult('data-integration', 'Route Planner', 'pass', 'Working route planner available');
                    dataIntegrationScore += 50;
                } else {
                    addTestResult('data-integration', 'Route Planner', 'fail', 'Working route planner not found');
                }
            } catch (error) {
                addTestResult('data-integration', 'Route Planner', 'fail', 'Route planner not accessible');
            }
            
            updateProgress('data-integration', dataIntegrationScore);
        }

        // PWA Features Testing
        async function testPWAFeatures() {
            console.log('üì± Testing PWA Features...');
            
            // Test 1: Service Worker
            let serviceWorkerScore = 0;
            
            if ('serviceWorker' in navigator) {
                addTestResult('service-worker', 'API Support', 'pass', 'Service Worker API supported');
                serviceWorkerScore += 50;
                
                // Check if service worker is registered
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        addTestResult('service-worker', 'Registration', 'pass', 'Service Worker registered');
                        serviceWorkerScore += 50;
                    } else {
                        addTestResult('service-worker', 'Registration', 'warning', 'Service Worker not registered');
                        serviceWorkerScore += 25;
                    }
                } catch (error) {
                    addTestResult('service-worker', 'Registration', 'fail', 'Service Worker registration failed');
                }
            } else {
                addTestResult('service-worker', 'API Support', 'fail', 'Service Worker API not supported');
            }
            
            updateProgress('service-worker', serviceWorkerScore);

            // Test 2: Manifest
            let manifestScore = 0;
            
            const manifestLink = document.querySelector('link[rel="manifest"]');
            if (manifestLink) {
                addTestResult('manifest', 'Manifest Link', 'pass', 'Manifest link found');
                manifestScore += 50;
                
                // Check if manifest file exists
                try {
                    const response = await fetch(manifestLink.href);
                    if (response.ok) {
                        const manifest = await response.json();
                        if (manifest.name && manifest.short_name) {
                            addTestResult('manifest', 'Manifest Content', 'pass', 'Valid manifest content');
                            manifestScore += 50;
                        } else {
                            addTestResult('manifest', 'Manifest Content', 'warning', 'Manifest missing required fields');
                            manifestScore += 25;
                        }
                    } else {
                        addTestResult('manifest', 'Manifest File', 'fail', 'Manifest file not accessible');
                    }
                } catch (error) {
                    addTestResult('manifest', 'Manifest File', 'fail', 'Manifest file error');
                }
            } else {
                addTestResult('manifest', 'Manifest Link', 'fail', 'Manifest link not found');
            }
            
            updateProgress('manifest', manifestScore);

            // Test 3: Install Prompt
            let installPromptScore = 0;
            
            if ('beforeinstallprompt' in window) {
                addTestResult('install-prompt', 'Install Prompt', 'pass', 'Install prompt available');
                installPromptScore += 100;
            } else {
                addTestResult('install-prompt', 'Install Prompt', 'info', 'Install prompt not available (normal in some browsers)');
                installPromptScore += 50;
            }
            
            updateProgress('install-prompt', installPromptScore);
        }

        // Performance Testing
        async function testPerformance() {
            console.log('‚ö° Testing Performance...');
            
            const startTime = performance.now();
            
            // Load main page
            const response = await fetch('http://localhost:8000/index.html');
            const html = await response.text();
            
            const loadTime = performance.now() - startTime;
            document.getElementById('load-time').textContent = `${loadTime.toFixed(2)}ms`;
            
            // Count resources
            const resourceCount = (html.match(/href=|src=/g) || []).length;
            document.getElementById('resource-count').textContent = resourceCount;
            
            // Calculate total file size
            let totalSize = 0;
            const files = ['index.html', 'app.js', 'style.css', 'manifest.json', 'sw.js'];
            
            for (const file of files) {
                try {
                    const fileResponse = await fetch(`http://localhost:8000/${file}`);
                    if (fileResponse.ok) {
                        const size = parseInt(fileResponse.headers.get('content-length') || '0');
                        totalSize += size;
                    }
                } catch (error) {
                    console.log(`Error loading ${file}:`, error);
                }
            }
            
            document.getElementById('file-size').textContent = formatBytes(totalSize);
            
            // Count CSS rules
            const cssResponse = await fetch('http://localhost:8000/style.css');
            const css = await cssResponse.text();
            const cssRules = (css.match(/\{[^}]*\}/g) || []).length;
            document.getElementById('css-rules').textContent = cssRules;
            
            // Performance analysis
            let performanceScore = 0;
            
            if (loadTime < 100) {
                addTestResult('performance', 'Load Time', 'pass', `Excellent load time: ${loadTime.toFixed(2)}ms`);
                performanceScore += 100;
            } else if (loadTime < 500) {
                addTestResult('performance', 'Load Time', 'warning', `Good load time: ${loadTime.toFixed(2)}ms`);
                performanceScore += 75;
            } else {
                addTestResult('performance', 'Load Time', 'fail', `Slow load time: ${loadTime.toFixed(2)}ms`);
                performanceScore += 25;
            }
            
            if (totalSize < 50000) {
                addTestResult('performance', 'File Size', 'pass', `Small total size: ${formatBytes(totalSize)}`);
                performanceScore += 100;
            } else if (totalSize < 200000) {
                addTestResult('performance', 'File Size', 'warning', `Moderate total size: ${formatBytes(totalSize)}`);
                performanceScore += 75;
            } else {
                addTestResult('performance', 'File Size', 'fail', `Large total size: ${formatBytes(totalSize)}`);
                performanceScore += 25;
            }
            
            updateProgress('performance', performanceScore);
        }

        // Accessibility Testing
        async function testAccessibility() {
            console.log('‚ôø Testing Accessibility...');
            
            const frame = document.getElementById('website-preview');
            const frameDoc = frame.contentDocument || frame.contentWindow.document;
            
            // Test 1: ARIA Labels
            let ariaLabelsScore = 0;
            
            const ariaElements = frameDoc.querySelectorAll('[aria-label], [aria-labelledby], [role]');
            if (ariaElements.length > 0) {
                addTestResult('aria-labels', 'ARIA Elements', 'pass', `Found ${ariaElements.length} ARIA elements`);
                ariaLabelsScore += 100;
            } else {
                addTestResult('aria-labels', 'ARIA Elements', 'warning', 'No ARIA elements found');
                ariaLabelsScore += 50;
            }
            
            updateProgress('aria-labels', ariaLabelsScore);

            // Test 2: Keyboard Navigation
            let keyboardNavScore = 0;
            
            const focusableElements = frameDoc.querySelectorAll('button, input, select, textarea, a, [tabindex]');
            if (focusableElements.length > 0) {
                addTestResult('keyboard-nav', 'Focusable Elements', 'pass', `Found ${focusableElements.length} focusable elements`);
                keyboardNavScore += 100;
            } else {
                addTestResult('keyboard-nav', 'Focusable Elements', 'fail', 'No focusable elements found');
            }
            
            updateProgress('keyboard-nav', keyboardNavScore);

            // Test 3: Color Contrast
            let colorContrastScore = 0;
            
            // Basic color contrast check
            const textElements = frameDoc.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, div');
            if (textElements.length > 0) {
                addTestResult('color-contrast', 'Text Elements', 'pass', `Found ${textElements.length} text elements`);
                colorContrastScore += 100;
            } else {
                addTestResult('color-contrast', 'Text Elements', 'warning', 'No text elements found');
                colorContrastScore += 50;
            }
            
            updateProgress('color-contrast', colorContrastScore);
        }

        // Run All Tests
        async function runAllTests() {
            console.log('üöÄ Running all comprehensive tests...');
            
            // Clear previous results
            Object.keys(testResults).forEach(section => {
                const container = document.getElementById(`${section}-results`);
                if (container) container.innerHTML = '';
            });
            
            Object.keys(detailedLogs).forEach(section => {
                detailedLogs[section] = [];
            });
            
            // Run tests in sequence
            await testTabNavigation();
            await testRoutePlanning();
            await testPWAFeatures();
            await testPerformance();
            await testAccessibility();
            
            // Calculate overall score
            calculateOverallScore();
        }

        function calculateOverallScore() {
            const sections = ['css-nav', 'radio-states', 'visual-feedback', 'form-elements', 'map-integration', 'data-integration', 'service-worker', 'manifest', 'install-prompt'];
            
            let totalScore = 0;
            let maxScore = sections.length * 100;
            
            sections.forEach(section => {
                const progressBar = document.getElementById(`${section}-progress`);
                if (progressBar) {
                    const width = parseInt(progressBar.style.width) || 0;
                    totalScore += width;
                }
            });
            
            const overallScore = Math.round((totalScore / maxScore) * 100);
            document.getElementById('overall-score').textContent = `${overallScore}%`;
            
            console.log(`üéâ Overall Score: ${overallScore}%`);
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testPerformance();
            }, 2000);
        });
    </script>
</body>
</html>
