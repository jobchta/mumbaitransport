<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mumbai Transport - Final Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .status-card.pass { border-left-color: #28a745; }
        .status-card.fail { border-left-color: #dc3545; }
        .status-card.warning { border-left-color: #ffc107; }
    </style>
</head>
<body>
    <h1>🚇 Mumbai Transport - Final Comprehensive Test</h1>
    
    <div class="test-section">
        <h2>📋 Test Summary</h2>
        <p>This page will test all components of the Mumbai Transport website to ensure everything is working correctly.</p>
        <button onclick="runAllTests()">Run Complete Test Suite</button>
        <button onclick="testMainWebsite()">Test Main Website</button>
        <button onclick="testRoutePlanner()">Test Route Planner</button>
        <button onclick="testFileSystem()">Test File System</button>
    </div>

    <div class="test-section">
        <h2>🎯 Live Website Test</h2>
        <p>Testing the main website (index.html):</p>
        <iframe id="main-website" src="http://localhost:8000/index.html"></iframe>
    </div>

    <div class="test-section">
        <h2>📱 Component Status</h2>
        <div class="status-grid" id="status-grid">
            <!-- Status cards will be populated here -->
        </div>
    </div>

    <div class="test-section">
        <h2>🔍 Test Results</h2>
        <div id="test-results"></div>
    </div>

    <script>
        let testResults = [];

        function addTestResult(testName, status, message) {
            const result = { testName, status, message, timestamp: new Date() };
            testResults.push(result);
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${status}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${message}`;
            
            document.getElementById('test-results').appendChild(resultDiv);
            console.log(`[${status.toUpperCase()}] ${testName}: ${message}`);
            
            // Update status grid
            updateStatusGrid();
        }

        function updateStatusGrid() {
            const grid = document.getElementById('status-grid');
            grid.innerHTML = '';
            
            const components = [
                { name: 'File Loading', tests: testResults.filter(r => r.testName.includes('File')) },
                { name: 'Tab Navigation', tests: testResults.filter(r => r.testName.includes('Tab')) },
                { name: 'Route Planning', tests: testResults.filter(r => r.testName.includes('Route')) },
                { name: 'PWA Features', tests: testResults.filter(r => r.testName.includes('PWA')) },
                { name: 'CSS Styling', tests: testResults.filter(r => r.testName.includes('CSS')) },
                { name: 'JavaScript', tests: testResults.filter(r => r.testName.includes('JavaScript')) }
            ];
            
            components.forEach(component => {
                const card = document.createElement('div');
                card.className = 'status-card';
                
                const passed = component.tests.filter(t => t.status === 'pass').length;
                const failed = component.tests.filter(t => t.status === 'fail').length;
                const total = component.tests.length;
                
                let status = 'info';
                if (failed > 0) status = 'fail';
                else if (passed > 0) status = 'pass';
                
                card.classList.add(status);
                
                card.innerHTML = `
                    <h3>${component.name}</h3>
                    <p>Tests: ${passed} passed, ${failed} failed</p>
                    <p>Total: ${total} tests</p>
                `;
                
                grid.appendChild(card);
            });
        }

        // Test File System
        async function testFileSystem() {
            addTestResult('File System', 'info', 'Starting file system test...');
            
            const filesToTest = [
                { name: 'index.html', required: true },
                { name: 'app.js', required: true },
                { name: 'style.css', required: true },
                { name: 'manifest.json', required: true },
                { name: 'sw.js', required: true },
                { name: 'real_mumbai_transport_data.js', required: false },
                { name: 'working_route_planner.html', required: false },
                { name: 'test.html', required: false }
            ];
            
            for (const file of filesToTest) {
                try {
                    const response = await fetch(`http://localhost:8000/${file.name}`);
                    if (response.ok) {
                        const size = response.headers.get('content-length');
                        addTestResult('File System', 'pass', `${file.name} loads (${size} bytes)`);
                    } else {
                        if (file.required) {
                            addTestResult('File System', 'fail', `${file.name} failed to load (${response.status})`);
                        } else {
                            addTestResult('File System', 'warning', `${file.name} not found (${response.status})`);
                        }
                    }
                } catch (error) {
                    if (file.required) {
                        addTestResult('File System', 'fail', `${file.name} failed to load: ${error.message}`);
                    } else {
                        addTestResult('File System', 'warning', `${file.name} not accessible: ${error.message}`);
                    }
                }
            }
        }

        // Test Main Website
        async function testMainWebsite() {
            addTestResult('Main Website', 'info', 'Testing main website functionality...');
            
            try {
                const frame = document.getElementById('main-website');
                const frameDoc = frame.contentDocument || frame.contentWindow.document;
                
                // Wait for frame to load
                await new Promise(resolve => {
                    if (frameDoc.readyState === 'complete') {
                        resolve();
                    } else {
                        frame.addEventListener('load', resolve);
                    }
                });

                // Test 1: Check if CSS is loaded
                const styles = frameDoc.querySelectorAll('link[rel="stylesheet"]');
                const hasLocalCSS = Array.from(styles).some(link => link.href.includes('style.css'));
                
                if (hasLocalCSS) {
                    addTestResult('Main Website', 'pass', 'Local CSS file is loaded');
                } else {
                    addTestResult('Main Website', 'fail', 'Local CSS file not loaded');
                }

                // Test 2: Check if JavaScript is loaded
                const scripts = frameDoc.querySelectorAll('script[src*="app.js"]');
                if (scripts.length > 0) {
                    addTestResult('Main Website', 'pass', 'Local JavaScript file is loaded');
                } else {
                    addTestResult('Main Website', 'fail', 'Local JavaScript file not loaded');
                }

                // Test 3: Check tab navigation
                const radioButtons = frameDoc.querySelectorAll('input[type="radio"][name="tabs"]');
                if (radioButtons.length >= 3) {
                    addTestResult('Main Website', 'pass', `Found ${radioButtons.length} tab radio buttons`);
                } else {
                    addTestResult('Main Website', 'fail', 'Tab radio buttons not found');
                }

                // Test 4: Check tab content
                const tabContent = frameDoc.querySelectorAll('.tab-content');
                if (tabContent.length >= 3) {
                    addTestResult('Main Website', 'pass', `Found ${tabContent.length} tab content sections`);
                } else {
                    addTestResult('Main Website', 'fail', 'Tab content sections not found');
                }

                // Test 5: Check form elements
                const fromInput = frameDoc.getElementById('from');
                const toInput = frameDoc.getElementById('to');
                if (fromInput && toInput) {
                    addTestResult('Main Website', 'pass', 'Route planning form elements found');
                } else {
                    addTestResult('Main Website', 'fail', 'Route planning form elements missing');
                }

                // Test 6: Check map container
                const mapContainer = frameDoc.getElementById('map');
                if (mapContainer) {
                    addTestResult('Main Website', 'pass', 'Map container found');
                } else {
                    addTestResult('Main Website', 'warning', 'Map container not found');
                }

            } catch (error) {
                addTestResult('Main Website', 'fail', `Error testing main website: ${error.message}`);
            }
        }

        // Test Route Planner
        async function testRoutePlanner() {
            addTestResult('Route Planner', 'info', 'Testing route planner functionality...');
            
            try {
                const response = await fetch('http://localhost:8000/working_route_planner.html');
                if (response.ok) {
                    addTestResult('Route Planner', 'pass', 'Route planner page loads successfully');
                } else {
                    addTestResult('Route Planner', 'fail', `Route planner failed to load (${response.status})`);
                }
            } catch (error) {
                addTestResult('Route Planner', 'fail', `Route planner error: ${error.message}`);
            }
        }

        // Test PWA Features
        async function testPWAFeatures() {
            addTestResult('PWA Features', 'info', 'Testing PWA features...');
            
            if ('serviceWorker' in navigator) {
                addTestResult('PWA Features', 'pass', 'Service Worker API supported');
            } else {
                addTestResult('PWA Features', 'fail', 'Service Worker API not supported');
            }
            
            if ('beforeinstallprompt' in window) {
                addTestResult('PWA Features', 'pass', 'App install prompt available');
            } else {
                addTestResult('PWA Features', 'info', 'App install prompt not available');
            }
        }

        // Test CSS and JavaScript
        async function testCSSAndJS() {
            addTestResult('CSS and JS', 'info', 'Testing CSS and JavaScript functionality...');
            
            try {
                // Test CSS
                const cssResponse = await fetch('http://localhost:8000/style.css');
                if (cssResponse.ok) {
                    const cssText = await cssResponse.text();
                    if (cssText.length > 100) {
                        addTestResult('CSS and JS', 'pass', 'CSS file loaded with content');
                    } else {
                        addTestResult('CSS and JS', 'fail', 'CSS file is empty or too small');
                    }
                } else {
                    addTestResult('CSS and JS', 'fail', 'CSS file failed to load');
                }
                
                // Test JavaScript
                const jsResponse = await fetch('http://localhost:8000/app.js');
                if (jsResponse.ok) {
                    const jsText = await jsResponse.text();
                    if (jsText.length > 100) {
                        addTestResult('CSS and JS', 'pass', 'JavaScript file loaded with content');
                    } else {
                        addTestResult('CSS and JS', 'fail', 'JavaScript file is empty or too small');
                    }
                } else {
                    addTestResult('CSS and JS', 'fail', 'JavaScript file failed to load');
                }
                
            } catch (error) {
                addTestResult('CSS and JS', 'fail', `Error testing files: ${error.message}`);
            }
        }

        // Run All Tests
        async function runAllTests() {
            addTestResult('Test Suite', 'info', 'Starting comprehensive test suite...');
            
            // Clear previous results
            document.getElementById('test-results').innerHTML = '';
            testResults = [];
            
            // Run tests in sequence
            await testFileSystem();
            await testCSSAndJS();
            await testPWAFeatures();
            await testRoutePlanner();
            await testMainWebsite();
            
            // Summary
            const passed = testResults.filter(r => r.status === 'pass').length;
            const failed = testResults.filter(r => r.status === 'fail').length;
            const warnings = testResults.filter(r => r.status === 'warning').length;
            
            addTestResult('Test Suite', 'info', `Completed: ${passed} passed, ${failed} failed, ${warnings} warnings`);
            
            if (failed === 0) {
                addTestResult('Test Suite', 'pass', '🎉 All critical tests passed! Website is working correctly.');
            } else {
                addTestResult('Test Suite', 'fail', '⚠️ Some tests failed. Please check the results above.');
            }
        }

        // Auto-run basic tests on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                testFileSystem();
            }, 1000);
        });
    </script>
</body>
</html>
