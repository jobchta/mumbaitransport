<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#5E6AD2" />
  <meta name="color-scheme" content="light dark" />
  <meta name="description" content="Mumbai Transport Hub: Live map, schedules, and updates for BEST buses, local trains, metro, monorail, and ferries." />
  <title>Mumbai Transport Hub | Real-Time Tracking</title>

  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin />
  <link rel="preconnect" href="https://unpkg.com" crossorigin />
  <link rel="preconnect" href="https://tile.openstreetmap.org" crossorigin />
  <link rel="preconnect" href="https://maps.googleapis.com" crossorigin />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <!-- Leaflet for real map rendering -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Google Maps API for accurate journey calculations -->
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&libraries=geometry,places&callback=initGoogleMaps"></script>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="network-banner" id="networkBanner" role="status" aria-live="polite"></div>
  <a href="#main" class="sr-only" id="skipLink">Skip to content</a>
  <div id="liveRegion" class="sr-only" aria-live="polite" aria-atomic="true"></div>

  <div class="app">
    <header class="header">
      <div class="header-top">
        <div class="logo" aria-label="Mumbai Transport Hub">
          <div class="logo-icon"><i class="fa-solid fa-train-subway"></i></div>
          Mumbai Transport Hub
        </div>
        <div class="header-actions">
          <button class="header-btn" id="theme-toggle" aria-label="Switch theme" type="button">
            <i class="fa-solid fa-moon"></i>
          </button>
          <button class="header-btn" id="notifications-btn" aria-label="Notifications" type="button">
            <i class="fa-solid fa-bell"></i>
          </button>
        </div>
      </div>
      <div class="search-bar">
        <i class="fa-solid fa-magnifying-glass search-icon" aria-hidden="true"></i>
        <input type="text" class="search-input" id="searchInput" placeholder="Search routes or destinations..." aria-label="Search routes or destinations" autocomplete="off" />
      </div>
      <div style="display:flex; gap:8px; margin-top:4px;">
        <span class="chip" id="share-btn" role="button" tabindex="0"><i class="fa-solid fa-share-from-square"></i> Share</span>
        <span class="chip info" id="home-refresh" role="button" tabindex="0"><i class="fa-solid fa-arrows-rotate"></i> Refresh</span>
        <div id="commit-info"></div>
      </div>
    </header>

    <main class="content" id="main">
      <section aria-labelledby="home-panel-heading" id="home-panel">
        <h2 class="section-title" id="home-panel-heading"><i class="fa-solid fa-star"></i> Your Home</h2>
        <div class="updates-list" style="margin-bottom: 12px;">
          <div class="update-item">
            <div class="update-icon" style="background: var(--primary);"><i class="fa-solid fa-magnifying-glass"></i></div>
            <div class="update-content" style="width:100%">
              <div class="update-text" style="display:flex; justify-content:space-between; align-items:center;">
                <span>Recent Searches</span><button id="clear-recent" class="chip" type="button">Clear</button>
              </div>
              <div id="recentList" style="margin-top:8px; display:flex; flex-wrap:wrap; gap:8px;"></div>
            </div>
          </div>
        </div>
        <div class="updates-list">
          <div class="update-item">
            <div class="update-icon" style="background: var(--success);"><i class="fa-solid fa-bookmark"></i></div>
            <div class="update-content" style="width:100%">
              <div class="update-text" style="display:flex; justify-content:space-between; align-items:center;">
                <span>Saved Trips</span><button id="clear-trips" class="chip" type="button">Clear</button>
              </div>
              <div id="tripsList" style="margin-top:8px; display:flex; flex-direction:column; gap:8px;"></div>
            </div>
          </div>
        </div>
      </section>
      <section aria-labelledby="modes-heading">
        <h2 class="section-title" id="modes-heading"><i class="fa-solid fa-bus"></i> Transport Modes <span class="live-indicator">LIVE</span></h2>
        <div class="transport-grid" role="tablist" aria-label="Transport modes">
          <button class="transport-card active" data-transport="bus" role="tab" aria-selected="true" type="button">
            <div class="card-header">
              <div class="bus-icon card-icon"><i class="fa-solid fa-bus"></i></div>
              <div class="card-title">BEST Buses</div>
            </div>
            <div class="card-status">
              <span class="status-indicator status-active" aria-hidden="true"></span>
              <span class="card-status-text">Operational</span>
            </div>
            <div class="card-stats" aria-hidden="true">
              <div class="stat">
                <span class="stat-number" id="bus-count">518</span>
                <span class="stat-label">Routes</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="bus-ontime">3,800</span>
                <span class="stat-label">Buses</span>
              </div>
            </div>
          </button>

          <button class="transport-card" data-transport="train" role="tab" aria-selected="false" type="button">
            <div class="card-header">
              <div class="train-icon card-icon"><i class="fa-solid fa-train-subway"></i></div>
              <div class="card-title">Local Trains</div>
            </div>
            <div class="card-status">
              <span class="status-indicator status-delayed" aria-hidden="true"></span>
              <span class="card-status-text">Minor Delays</span>
            </div>
            <div class="card-stats" aria-hidden="true">
              <div class="stat">
                <span class="stat-number" id="train-count">2,847</span>
                <span class="stat-label">Services</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="train-ontime">87%</span>
                <span class="stat-label">On Time</span>
              </div>
            </div>
          </button>

          <button class="transport-card" data-transport="metro" role="tab" aria-selected="false" type="button">
            <div class="card-header">
              <div class="metro-icon card-icon"><i class="fa-solid fa-train-tram"></i></div>
              <div class="card-title">Metro</div>
            </div>
            <div class="card-status">
              <span class="status-indicator status-active" aria-hidden="true"></span>
              <span class="card-status-text">Operational</span>
            </div>
            <div class="card-stats" aria-hidden="true">
              <div class="stat">
                <span class="stat-number" id="metro-count">12</span>
                <span class="stat-label">Lines</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="metro-ontime">98%</span>
                <span class="stat-label">On Time</span>
              </div>
            </div>
          </button>

          <button class="transport-card" data-transport="ferry" role="tab" aria-selected="false" type="button">
            <div class="card-header">
              <div class="ferry-icon card-icon"><i class="fa-solid fa-ship"></i></div>
              <div class="card-title">Ferry</div>
            </div>
            <div class="card-status">
              <span class="status-indicator status-active" aria-hidden="true"></span>
              <span class="card-status-text">Operational</span>
            </div>
            <div class="card-stats" aria-hidden="true">
              <div class="stat">
                <span class="stat-number" id="ferry-count">8</span>
                <span class="stat-label">Routes</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="ferry-ontime">95%</span>
                <span class="stat-label">On Time</span>
              </div>
            </div>
          </button>

          <button class="transport-card" data-transport="monorail" role="tab" aria-selected="false" type="button">
            <div class="card-header">
              <div class="mono-icon card-icon"><i class="fa-solid fa-train"></i></div>
              <div class="card-title">Monorail</div>
            </div>
            <div class="card-status">
              <span class="status-indicator status-active" aria-hidden="true"></span>
              <span class="card-status-text">Operational</span>
            </div>
            <div class="card-stats" aria-hidden="true">
              <div class="stat">
                <span class="stat-number" id="monorail-count">1</span>
                <span class="stat-label">Line</span>
              </div>
              <div class="stat">
                <span class="stat-number" id="monorail-ontime">94%</span>
                <span class="stat-label">On Time</span>
              </div>
            </div>
          </button>
        </div>
      </section>

      <section aria-labelledby="live-heading">
        <h2 class="section-title" id="live-heading"><i class="fa-solid fa-map-location-dot"></i> Live Vehicle Tracking <span class="live-indicator">LIVE</span></h2>
        <div class="map-container">
          <div id="leafletMap" role="img" aria-label="Live map of Mumbai vehicles"></div>
          <div class="map-fallback" id="mapFallback" hidden>
            <div class="map-bg"></div>
            <div class="map-grid"></div>
            <div class="map-content" id="mapContent" aria-hidden="true"></div>
          </div>
        </div>
      </section>

      <section aria-labelledby="departures-heading">
        <h2 class="section-title" id="departures-heading"><i class="fa-solid fa-clock"></i> Next Departures</h2>
        <div class="schedule-controls">
          <label for="refTime">Check time:</label>
          <input type="time" id="refTime" />
          <button id="useNow" type="button">Now</button>
        </div>
        <div class="schedule-list" id="scheduleList" role="list"></div>
      </section>

      <section aria-labelledby="actions-heading">
        <h2 class="section-title" id="actions-heading"><i class="fa-solid fa-bolt"></i> Quick Actions</h2>
        <div class="action-grid">
          <button class="action-button" id="buy-ticket" type="button">
            <span class="action-icon"><i class="fa-solid fa-ticket"></i></span>
            Buy Ticket
          </button>
          <button class="action-button" id="plan-journey" type="button">
            <span class="action-icon"><i class="fa-solid fa-route"></i></span>
            Plan Journey
          </button>
          <button class="action-button" id="nearby-stations" type="button">
            <span class="action-icon"><i class="fa-solid fa-map-pin"></i></span>
            Nearby Stations
          </button>
          <button class="action-button" id="recharge-card" type="button">
            <span class="action-icon"><i class="fa-solid fa-wallet"></i></span>
            Recharge Card
          </button>
          <button class="action-button" id="fare-estimator" type="button">
            <span class="action-icon"><i class="fa-solid fa-indian-rupee-sign"></i></span>
            Fare Estimator (Auto)
          </button>
        </div>
      </section>
      <section aria-labelledby="location-heading">
        <h2 class="section-title" id="location-heading">
          <i class="fa-solid fa-location-dot"></i> 
          Personalized for Your Location
          <button class="location-btn" onclick="locationSystem?.getUserLocation()">
            <i class="fa-solid fa-crosshairs"></i> Update Location
          </button>
        </h2>
        
        <div class="location-status" id="location-status">
          <div class="status-message">📍 Detecting your location...</div>
        </div>

        <div class="location-sections">
          <div class="location-section">
            <h3 class="subsection-title">
              <i class="fa-solid fa-map-marker-alt"></i> Routes Near You
            </h3>
            <div id="nearby-routes-section" class="nearby-routes">
              <p>Enable location access to see nearby routes</p>
            </div>
          </div>

          <div class="location-section">
            <h3 class="subsection-title">
              <i class="fa-solid fa-clock"></i> Time-Based Recommendations
            </h3>
            <div id="time-recommendations-section" class="time-recommendations">
              <p>Loading recommendations...</p>
            </div>
          </div>

          <div class="location-section">
            <h3 class="subsection-title">
              <i class="fa-solid fa-star"></i> Your Favorite Routes
            </h3>
            <div id="favorite-routes-section" class="favorite-routes">
              <p>Add routes to favorites to see them here</p>
            </div>
          </div>
        </div>
      </section>
      <section aria-labelledby="smart-planning-heading">
        <h2 class="section-title" id="smart-planning-heading">
          <i class="fa-solid fa-route"></i> Smart Route Planning
          <span class="live-indicator">LIVE</span>
        </h2>
        
        <div class="route-planner">
          <div class="planner-inputs">
            <div class="input-group">
              <label for="from-location">From:</label>
              <input type="text" id="from-location" placeholder="Enter starting point" />
            </div>
            <div class="input-group">
              <label for="to-location">To:</label>
              <input type="text" id="to-location" placeholder="Enter destination" />
            </div>
            <div class="input-group">
              <label for="preference">Preference:</label>
              <select id="preference">
                <option value="fastest">Fastest Route</option>
                <option value="cheapest">Cheapest Route</option>
                <option value="comfortable">Most Comfortable</option>
                <option value="fewest-transfers">Fewest Transfers</option>
              </select>
            </div>
            <button class="plan-route-btn" onclick="planSmartRoute()">
              <i class="fa-solid fa-search"></i> Plan Route
            </button>
          </div>
          
          <div class="route-results" id="route-results">
            <div class="results-placeholder">
              <i class="fa-solid fa-route"></i>
              <p>Enter your journey details to get smart route recommendations</p>
            </div>
          </div>
        </div>
      </section>

      <section aria-labelledby="live-tracking-heading">
        <h2 class="section-title" id="live-tracking-heading">
          <i class="fa-solid fa-satellite"></i> Live Bus Tracking
        </h2>
        
        <div class="live-tracking">
          <div class="tracking-filters">
            <input type="text" id="track-route" placeholder="Enter route number (e.g., A1, 21, 242)" />
            <button onclick="trackRoute()">Track Bus</button>
          </div>
          
          <div class="tracking-results" id="tracking-results">
            <div class="tracking-placeholder">
              <i class="fa-solid fa-bus"></i>
              <p>Enter a route number to see live bus locations</p>
            </div>
          </div>
        </div>
      </section>

      <section aria-labelledby="service-alerts-heading">
        <h2 class="section-title" id="service-alerts-heading">
          <i class="fa-solid fa-triangle-exclamation"></i> Live Service Alerts
        </h2>
        
        <div class="service-alerts" id="service-alerts-container">
          <div class="alert alert-info">
            <div class="alert-header">
              <span class="alert-type">INFO</span>
              <span class="alert-route">SYSTEM</span>
            </div>
            <div class="alert-message">Real-time service alerts will appear here</div>
            <div class="alert-time">Live updates</div>
          </div>
        </div>
      </section>

      <section aria-labelledby="updates-heading">
        <h2 class="section-title" id="updates-heading"><i class="fa-solid fa-triangle-exclamation"></i> Service Updates</h2>
        <div class="updates-list" id="updatesList" role="feed" aria-live="polite"></div>
      </section>

      <section aria-labelledby="metro-info-heading">
        <h2 class="section-title" id="metro-info-heading"><i class="fa-solid fa-circle-info"></i> Mumbai Metro Network Status</h2>
        <div class="updates-list">
          <div class="update-item">
            <div class="update-icon" style="background: var(--info);">
              <i class="fa-solid fa-train-tram"></i>
            </div>
            <div class="update-content">
              <div class="update-text"><strong>Operational lines</strong>: Line 1 (Versova–Andheri–Ghatkopar), Line 2A (Dahisar–Dahanukarwadi), Line 7 (Andheri East–Dahisar East).</div>
              <div class="update-time">Verified metro info (June 2025)</div>
            </div>
          </div>
          <div class="update-item">
            <div class="update-icon" style="background: var(--warning);">
              <i class="fa-solid fa-wrench"></i>
            </div>
            <div class="update-content">
              <div class="update-text"><strong>Under construction / planned</strong>: Line 3 (Colaba–Bandra–SEEPZ), Line 5 (Thane–Bhiwandi–Kalyan), Line 6 (Swami Samarth Nagar–Vikhroli).</div>
              <div class="update-time">Compiled from official/public sources</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <nav class="bottom-nav" role="navigation" aria-label="Primary">
      <button class="nav-button active" data-nav="home" type="button">
        <i class="nav-icon fa-solid fa-house"></i>
        Home
      </button>
      <button class="nav-button" data-nav="map" type="button">
        <i class="nav-icon fa-solid fa-map-location"></i>
        Map
      </button>
      <button class="nav-button" data-nav="tickets" type="button">
        <i class="nav-icon fa-solid fa-ticket"></i>
        Tickets
      </button>
      <button class="nav-button" data-nav="journey" type="button">
        <i class="nav-icon fa-solid fa-route"></i>
        Journey
      </button>
      <button class="nav-button" data-nav="account" type="button">
        <i class="nav-icon fa-solid fa-user"></i>
        Account
      </button>
    </nav>
  </div>

  <!-- Floating Action Button (Quick Menu) -->
  <div class="fab" id="fab">
    <div class="fab-menu">
      <div class="fab-item" id="fab-fare"><i class="fa-solid fa-indian-rupee-sign"></i> Fare Estimator</div>
      <div class="fab-item" id="fab-tickets"><i class="fa-solid fa-ticket"></i> Tickets</div>
      <div class="fab-item" id="fab-nearby"><i class="fa-solid fa-location-arrow"></i> Nearby</div>
    </div>
    <button class="fab-main" id="fab-main" aria-label="Open quick menu"><i class="fa-solid fa-plus"></i></button>
  </div>

  <!-- Mini bottom map -->
  <div class="mini-map" id="miniMapWrap" aria-hidden="true">
    <div class="mini-map-overlay"><span class="chip" id="miniMapStatus">Live</span></div>
    <div id="miniMap"></div>
  </div>

  <!-- Bottom Sheet Modal -->
  <div class="sheet-backdrop" id="sheetBackdrop"></div>
  <div class="sheet" id="sheet" role="dialog" aria-modal="true" aria-labelledby="sheetTitle" aria-hidden="true">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="sheet-title" id="sheetTitle">Details</div>
      <button class="sheet-close" id="sheetClose" type="button" aria-label="Close">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="sheet-body" id="sheetBody">
      <p>Loading...</p>
    </div>
  </div>

  <noscript>
    <div class="notification" role="alert">This app needs JavaScript enabled.</div>
  </noscript>

  <!-- Leaflet JS with fallback CDN -->
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" onerror="(function(){var s=document.createElement('script');s.defer=true;s.src='https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js';document.head.appendChild(s);})()"></script>
  
  <!-- PhonePe SDK Integration -->
  <script>
    // PhonePe Payment Configuration
    window.PhonePeConfig = {
      merchantId: 'DEMO_MERCHANT', // Demo merchant ID
      saltKey: 'DEMO_SALT_KEY',    // Demo salt key  
      saltIndex: '1',              // Demo salt index
      environment: 'UAT',          // UAT for testing, PRODUCTION for live
      callbackUrl: window.location.origin + '/payment-callback',
      redirectUrl: window.location.origin + '/payment-success'
    };
  </script>

  <script src="main.js" defer></script>
  <script src="app.js"></script>
</body>
</html>

