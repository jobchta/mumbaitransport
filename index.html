<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Mumbai Transport - Plan journeys, buy tickets, compare rides">
    <meta name="theme-color" content="#0ea5e9">
    <title>Mumbai Transport</title>

    <!-- PWA Configuration -->
    <link rel="manifest" href="src/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mumbai Transport">
    <link rel="apple-touch-icon" href="src/assets/icons/icon-192x192.png">
    
    <!-- External Dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="src/styles/style.css">
    
    <!-- Application Scripts -->
    <script defer src="src/js/language-manager.js"></script>
    <script defer src="src/js/app.js"></script>
    <script defer src="src/js/component-loader.js"></script>
    
    <!-- Google Maps API -->
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4VXgebBaqOojiujAPYIP8Qv-iYPSFVWw&libraries=places,geometry,visualization&v=weekly&callback=initMap"></script>
</head>
<body>
    <!-- Application Shell -->
    <div class="app-shell">
        <!-- Header Container -->
        <div id="header-container"></div>

        <!-- Main Content Area -->
        <main class="app-content">
            <div id="plan-tab-container"></div>
            <div id="tickets-tab-container"></div>
            <div id="compare-tab-container"></div>
        </main>

        <!-- Navigation Container -->
        <div id="tab-navigation-container"></div>
    </div>

    <!-- PWA Install Banner -->
    <div class="pwa-install-banner" id="pwa-install-banner">
        <div class="pwa-banner-content">
            <div class="pwa-banner-icon">
                <i class="ph ph-download-simple"></i>
            </div>
            <div class="pwa-banner-text">
                <h3>Install Mumbai Transport</h3>
                <p>Add to your home screen for quick access</p>
            </div>
        </div>
        <div class="pwa-banner-actions">
            <button class="pwa-btn pwa-btn-primary" id="pwa-install-btn">Install</button>
            <button class="pwa-btn pwa-btn-secondary" id="pwa-dismiss-btn">Not Now</button>
        </div>
    </div>

    <!-- iOS Install Hint -->
    <div class="ios-install-hint" id="ios-install-hint">
        <div class="ios-hint-content">
            <div class="ios-hint-icon">
                <i class="ph ph-device-mobile"></i>
            </div>
            <div class="ios-hint-text">
                <h4>Add to Home Screen</h4>
                <p>Install this app on your iPhone: tap the share button and then "Add to Home Screen".</p>
                <div class="ios-hint-steps">
                    <i class="ph ph-share"></i>
                    <span>Share</span>
                    <i class="ph ph-arrow-right"></i>
                    <span>Add to Home Screen</span>
                </div>
            </div>
            <button class="ios-hint-close" id="ios-hint-close">
                <i class="ph ph-x"></i>
            </button>
        </div>
    </div>

    <!-- Application Initialization -->
    <script>
        // Global Application State
        window.AppState = {
            map: null,
            directionsService: null,
            directionsRenderer: null,
            placesService: null,
            fromAutocomplete: null,
            toAutocomplete: null
        };

        // Initialize Google Maps
        function initMap() {
            console.log('🗺️ Initializing Google Maps...');
            
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.warn('⚠️ Map container not found');
                return;
            }

            AppState.map = new google.maps.Map(mapElement, {
                center: { lat: 19.0760, lng: 72.8777 },
                zoom: 12,
                styles: [
                    {
                        featureType: 'transit',
                        elementType: 'labels.icon',
                        stylers: [{ visibility: 'on' }]
                    }
                ]
            });

            AppState.directionsService = new google.maps.DirectionsService();
            AppState.directionsRenderer = new google.maps.DirectionsRenderer();
            AppState.directionsRenderer.setMap(AppState.map);
            AppState.placesService = new google.maps.places.PlacesService(AppState.map);

            console.log('✅ Google Maps initialized');
        }

        // Initialize PWA Features
        function initPWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./src/sw.js')
                    .then(registration => {
                        console.log('✅ Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.log('❌ Service Worker registration failed:', error);
                    });
            }
            
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('📱 Install prompt ready');
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('📱 App installed successfully');
                deferredPrompt = null;
            });
        }

        // Toast Notification System
        function showToast(message, type = 'success') {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // Application Initialization
        document.addEventListener('DOMContentLoaded', function() {
            console.log('📱 DOM loaded, initializing application...');
            
            initPWA();
            showToast('Mumbai Transport Hub loaded successfully!', 'success');
        });

        // Export Global Functions
        window.showToast = showToast;
        window.initMap = initMap;
    </script>
</body>
</html>
