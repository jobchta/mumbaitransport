<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Mumbai Transport - Plan journeys, buy tickets, compare rides">
    <meta name="theme-color" content="#0ea5e9">
    <title>Mumbai Transport</title>

    <!-- PWA Configuration -->
    <link rel="manifest" href="src/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mumbai Transport">
    <link rel="apple-touch-icon" href="src/assets/icons/icon-192x192.png">
    
    <!-- External Dependencies -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="src/styles/style.css">
    
    <!-- Application Scripts -->
    <script defer src="src/js/component-loader.js"></script>
    <script defer src="src/js/app.js"></script>
    
    <!-- Google Maps API -->
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD4VXgebBaqOojiujAPYIP8Qv-iYPSFVWw&libraries=places,geometry,visualization&v=weekly&callback=initMap"></script>
</head>
<body>
    <!-- Application Shell -->
    <div class="app-shell">
        <!-- Header Container -->
        <div id="header-container"></div>

        <!-- Hidden Radio Inputs for CSS-Only Tab Control -->
        <input type="radio" name="tabs" id="plan-radio" class="tab-radio" checked>
        <input type="radio" name="tabs" id="tickets-radio" class="tab-radio">
        <input type="radio" name="tabs" id="compare-radio" class="tab-radio">

        <!-- App Content -->
        <main class="app-content">
            <!-- Plan Tab Container -->
            <div id="plan-tab-container"></div>
            
            <!-- Tickets Tab Container -->
            <div id="tickets-tab-container"></div>
            
            <!-- Compare Tab Container -->
            <div id="compare-tab-container"></div>
        </main>

        <!-- Tab Navigation Container -->
        <div id="tab-navigation-container"></div>
    </div>

    <script>
        // Global Variables
        let map;
        let directionsService;
        let directionsRenderer;
        let placesService;

        // Initialize Google Maps
        function initMap() {
            console.log('ðŸ—ºï¸ Initializing Google Maps...');
            
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.warn('âš ï¸ Map container not found');
                return;
            }

            map = new google.maps.Map(mapElement, {
                center: { lat: 19.0760, lng: 72.8777 },
                zoom: 12,
                styles: [
                    {
                        featureType: 'transit',
                        elementType: 'labels.icon',
                        stylers: [{ visibility: 'on' }]
                    }
                ]
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
            placesService = new google.maps.places.PlacesService(map);

            console.log('âœ… Google Maps initialized');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸ“± DOM loaded, initializing app...');
            
            // Initialize components
            initTabNavigation();
            initThemeToggle();
            initFormHandlers();
            initLanguageSelector();
            
            // Show welcome message
            showToast('Mumbai Transport Hub loaded successfully!', 'success');
        });

        // Initialize tab navigation
        function initTabNavigation() {
            console.log('ðŸ“± Initializing tab navigation...');
            
            // Add map resize functionality for plan tab when it becomes active
            const planRadio = document.getElementById('plan-radio');
            if (planRadio) {
                planRadio.addEventListener('change', () => {
                    if (planRadio.checked && typeof google !== 'undefined' && map) {
                        setTimeout(() => {
                            google.maps.event.trigger(map, 'resize');
                            console.log('ðŸ—ºï¸ Map resized for plan tab');
                        }, 100);
                    }
                });
            }
            
            // Add click handlers for transport mode tabs
            const modeTabs = document.querySelectorAll('.mode-tab');
            modeTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    modeTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const mode = tab.getAttribute('data-mode');
                    console.log(`ðŸš‡ Transport mode selected: ${mode}`);
                });
            });
        }

        // Initialize theme toggle
        function initThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('mumbai-transport-theme', newTheme);
                    
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.className = newTheme === 'dark' ? 'ph ph-moon' : 'ph ph-sun';
                    }
                });
                
                // Load saved theme
                const savedTheme = localStorage.getItem('mumbai-transport-theme');
                if (savedTheme) {
                    document.documentElement.setAttribute('data-theme', savedTheme);
                    const icon = themeToggle.querySelector('i');
                    if (icon) {
                        icon.className = savedTheme === 'dark' ? 'ph ph-moon' : 'ph ph-sun';
                    }
                }
            }
        }

        // Initialize form handlers
        function initFormHandlers() {
            const journeyForm = document.getElementById('journey-form');
            if (journeyForm) {
                journeyForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    handleJourneyForm();
                });
            }
            
            const swapButton = document.getElementById('swap-locations');
            if (swapButton) {
                swapButton.addEventListener('click', () => {
                    const fromInput = document.getElementById('from');
                    const toInput = document.getElementById('to');
                    
                    if (fromInput && toInput) {
                        const temp = fromInput.value;
                        fromInput.value = toInput.value;
                        toInput.value = temp;
                        console.log('ðŸ”„ Locations swapped');
                    }
                });
            }
        }

        // Handle journey form
        function handleJourneyForm() {
            const from = document.getElementById('from')?.value;
            const to = document.getElementById('to')?.value;
            
            if (!from || !to) {
                showToast('Please enter both from and to locations', 'error');
                return;
            }
            
            console.log(`ðŸ—ºï¸ Planning route from ${from} to ${to}`);
            showToast('Finding routes...', 'success');
        }

        // Initialize language selector
        function initLanguageSelector() {
            const languageBtn = document.getElementById('language-btn');
            const languageDropdown = document.getElementById('language-dropdown');
            const languageOptions = document.querySelectorAll('.language-option');

            if (languageBtn) {
                languageBtn.addEventListener('click', () => {
                    languageDropdown.classList.toggle('show');
                });
            }

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.language-selector')) {
                    languageDropdown.classList.remove('show');
                }
            });

            // Language option selection
            languageOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const lang = option.getAttribute('data-lang');
                    setLanguage(lang);
                    languageDropdown.classList.remove('show');
                });
            });
        }

        // Set language
        function setLanguage(lang) {
            const currentLanguageElement = document.getElementById('current-language');
            const languageOptions = document.querySelectorAll('.language-option');
            
            // Update current language display
            if (currentLanguageElement) {
                const languageNames = {
                    'en': 'English',
                    'hi': 'à¤¹à¤¿à¤‚à¤¦à¥€',
                    'mr': 'à¤®à¤°à¤¾à¤ à¥€',
                    'gu': 'àª—à«àªœàª°àª¾àª¤à«€',
                    'bn': 'à¦¬à¦¾à¦‚à¦²à¦¾',
                    'ta': 'à®¤à®®à®¿à®´à¯',
                    'te': 'à°¤à±†à°²à±à°—à±',
                    'kn': 'à²•à²¨à³à²¨à²¡',
                    'ml': 'à´®à´²à´¯à´¾à´³à´‚',
                    'pa': 'à¨ªà©°à¨œà¨¾à¨¬à©€'
                };
                currentLanguageElement.textContent = languageNames[lang] || 'English';
            }
            
            // Update active language option
            languageOptions.forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-lang') === lang) {
                    option.classList.add('active');
                }
            });
            
            localStorage.setItem('mumbai-transport-language', lang);
            console.log(`ðŸŒ Language changed to: ${lang}`);
            showToast(`Language changed to ${lang}`, 'success');
        }

        // Utility functions
        function showToast(message, type = 'success') {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        function buyTicket(line) {
            console.log(`ðŸŽ« Buying ticket for ${line}`);
            showToast(`Redirecting to ticket purchase for ${line}...`, 'success');
        }

        function checkFare(line) {
            console.log(`ðŸ’° Checking fare for ${line}`);
            showToast(`Fare information for ${line}`, 'success');
        }

        function selectRide(type) {
            console.log(`ðŸš— Selected ride type: ${type}`);
            showToast(`${type} selected for comparison`, 'success');
        }

        // Export functions
        window.showToast = showToast;
        window.initMap = initMap;
        window.buyTicket = buyTicket;
        window.checkFare = checkFare;
        window.selectRide = selectRide;
    </script>
</body>
</html>
