<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mumbai Transport - Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
    </style>
</head>
<body>
    <h1>üöå Mumbai Transport Hub - Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. Data System Test</h2>
        <button class="test-button" onclick="testDataSystem()">Test Data Loading</button>
        <div id="data-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Route Planning Test</h2>
        <button class="test-button" onclick="testRoutePlanning()">Test Route Planning</button>
        <div id="route-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Live Tracking Test</h2>
        <button class="test-button" onclick="testLiveTracking()">Test Live Tracking</button>
        <div id="tracking-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Console Logs</h2>
        <button class="test-button" onclick="clearLogs()">Clear Logs</button>
        <div id="console-logs"></div>
    </div>

    <script>
        // Real Mumbai Transport Data System
        const REAL_MUMBAI_TRANSPORT_DATA = {
            bestBusRoutes: [
                {
                    routeId: '41',
                    name: 'BEST Route 41',
                    operator: 'BEST',
                    from: 'Ayyappa Mandir',
                    to: 'Thane Station (W)',
                    stops: [
                        'Ayyappa Mandir', 'Srinagar Police Station', 'Parvat Nagar', 'Shanti Nagar',
                        'Saibaba Mandir', 'Ravi Fisheries', 'Wagle Circle', 'Durdwani', 'Road No 16',
                        'Passport Office', 'Automatic', 'Mulund Check Naka (Narpoli)', 'Kashish Park',
                        'Marathon Chowk (Teen Hath Naka)', 'Forest Office', 'Hari Niwas', 'Ice Factory',
                        'A.K. Joshi Vidyalaya', 'Thane Station (W)'
                    ],
                    totalStops: 19,
                    dailyTrips: 11,
                    firstBus: '7:00 AM',
                    lastBus: '10:00 PM',
                    returnFirstBus: '7:35 AM',
                    returnLastBus: '10:30 PM',
                    timings: ['7:00 AM', '8:10 AM', '9:15 AM', '12:35 PM', '1:35 PM', '3:45 PM', '4:50 PM', '6:00 PM', '8:45 PM', '8:55 PM', '10:00 PM'],
                    returnTimings: ['7:35 AM', '8:40 AM', '11:15 AM', '1:05 PM', '2:05 PM', '4:15 PM', '5:25 PM', '7:10 PM', '8:20 PM', '9:30 PM', '10:30 PM'],
                    estimatedDuration: 17,
                    fare: 15
                },
                {
                    routeId: '139',
                    name: 'BEST Route 139',
                    operator: 'BEST',
                    from: 'Colaba',
                    to: 'Bandra',
                    stops: ['Colaba', 'Gateway of India', 'CST Station', 'Churchgate Station', 'Marine Lines Station', 'Charni Road Station', 'Grant Road Station', 'Mumbai Central Station', 'Mahalaxmi Station', 'Lower Parel Station', 'Elphinstone Road Station', 'Prabhadevi Station', 'Dadar Station', 'Matunga Station', 'Sion Station', 'Kurla Station', 'Vidya Vihar Station', 'Ghatkopar Station', 'Vikhroli Station', 'Kanjurmarg Station', 'Bhandup Station', 'Nahur Station', 'Mulund Station', 'Thane Station', 'Bandra'],
                    totalStops: 25,
                    dailyTrips: 38,
                    firstBus: '6:00 AM',
                    lastBus: '11:00 PM',
                    estimatedDuration: 75,
                    fare: 20
                }
            ],
            localTrains: [
                {
                    line: 'Western Line',
                    stations: [
                        'Churchgate', 'Marine Lines', 'Charni Road', 'Grant Road', 'Mumbai Central',
                        'Mahalaxmi', 'Lower Parel', 'Elphinstone Road', 'Prabhadevi', 'Dadar',
                        'Matunga', 'Mahim', 'Bandra', 'Khar Road', 'Santacruz', 'Vile Parle',
                        'Andheri', 'Jogeshwari', 'Goregaon', 'Malad', 'Kandivali', 'Borivali',
                        'Dahisar', 'Mira Road', 'Bhayandar', 'Naigaon', 'Vasai Road', 'Nala Sopara', 'Virar'
                    ],
                    frequency: '3-5 minutes peak, 8-10 minutes off-peak',
                    firstTrain: '4:15 AM',
                    lastTrain: '1:30 AM',
                    estimatedDuration: 75,
                    fare: {
                        'Churchgate-Bandra': 10,
                        'Churchgate-Andheri': 15,
                        'Churchgate-Borivali': 20,
                        'Churchgate-Virar': 25
                    }
                }
            ]
        };

        // Test Functions
        function testDataSystem() {
            const results = document.getElementById('data-results');
            let html = '<div class="results success">';
            
            if (REAL_MUMBAI_TRANSPORT_DATA) {
                html += `
                    <h3>‚úÖ Data System Loaded Successfully</h3>
                    <p><strong>BEST Bus Routes:</strong> ${REAL_MUMBAI_TRANSPORT_DATA.bestBusRoutes.length}</p>
                    <p><strong>Local Train Lines:</strong> ${REAL_MUMBAI_TRANSPORT_DATA.localTrains.length}</p>
                    <p><strong>Sample Route:</strong> ${REAL_MUMBAI_TRANSPORT_DATA.bestBusRoutes[0].name}</p>
                `;
            } else {
                html = '<div class="results error"><h3>‚ùå Data System Failed to Load</h3></div>';
            }
            
            html += '</div>';
            results.innerHTML = html;
        }

        function testRoutePlanning() {
            const results = document.getElementById('route-results');
            let html = '<div class="results">';
            
            try {
                const routes = findRealRoutes('Colaba', 'Bandra');
                html += `
                    <h3>‚úÖ Route Planning Test</h3>
                    <p><strong>From:</strong> Colaba</p>
                    <p><strong>To:</strong> Bandra</p>
                    <p><strong>Routes Found:</strong> ${routes.length}</p>
                `;
                
                if (routes.length > 0) {
                    html += '<h4>Found Routes:</h4><ul>';
                    routes.forEach(route => {
                        html += `<li>${route.name} - ${route.estimatedDuration} min - ‚Çπ${route.fare}</li>`;
                    });
                    html += '</ul>';
                }
                
                html = html.replace('class="results">', 'class="results success">');
            } catch (error) {
                html = `
                    <div class="results error">
                        <h3>‚ùå Route Planning Test Failed</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
            
            results.innerHTML = html;
        }

        function testLiveTracking() {
            const results = document.getElementById('tracking-results');
            let html = '<div class="results">';
            
            try {
                const trackingData = getRealLiveTrackingData('41');
                html += `
                    <h3>‚úÖ Live Tracking Test</h3>
                    <p><strong>Route:</strong> ${trackingData.routeName}</p>
                    <p><strong>Active Buses:</strong> ${trackingData.buses.length}</p>
                    <p><strong>Crowd Level:</strong> ${trackingData.crowdLevel}%</p>
                    <p><strong>Traffic:</strong> ${trackingData.trafficCondition}</p>
                `;
                
                if (trackingData.buses.length > 0) {
                    html += '<h4>Active Buses:</h4><ul>';
                    trackingData.buses.forEach(bus => {
                        html += `<li>${bus.busId} - ${bus.progress}% complete - ${bus.passengers} passengers</li>`;
                    });
                    html += '</ul>';
                }
                
                html = html.replace('class="results">', 'class="results success">');
            } catch (error) {
                html = `
                    <div class="results error">
                        <h3>‚ùå Live Tracking Test Failed</h3>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
            }
            
            results.innerHTML = html;
        }

        function clearLogs() {
            document.getElementById('console-logs').innerHTML = '';
        }

        // Helper Functions (copied from main system)
        function findRealRoutes(from, to) {
            const routes = [];
            
            // Find BEST bus routes
            REAL_MUMBAI_TRANSPORT_DATA.bestBusRoutes.forEach(busRoute => {
                const fromMatch = busRoute.stops.some(stop => 
                    stop.toLowerCase().includes(from.toLowerCase())
                );
                const toMatch = busRoute.stops.some(stop => 
                    stop.toLowerCase().includes(to.toLowerCase())
                );
                
                if (fromMatch && toMatch) {
                    const fromIndex = busRoute.stops.findIndex(stop => 
                        stop.toLowerCase().includes(from.toLowerCase())
                    );
                    const toIndex = busRoute.stops.findIndex(stop => 
                        stop.toLowerCase().includes(to.toLowerCase())
                    );
                    
                    if (fromIndex < toIndex) {
                        routes.push({
                            id: busRoute.routeId,
                            name: busRoute.name,
                            type: 'bus',
                            operator: busRoute.operator,
                            from: busRoute.stops[fromIndex],
                            to: busRoute.stops[toIndex],
                            stops: busRoute.stops.slice(fromIndex, toIndex + 1),
                            estimatedDuration: Math.abs(toIndex - fromIndex) * 2,
                            fare: busRoute.fare,
                            transfers: 0,
                            mode: 'üöå'
                        });
                    }
                }
            });
            
            return routes;
        }

        function getRealLiveTrackingData(routeId) {
            const route = REAL_MUMBAI_TRANSPORT_DATA.bestBusRoutes.find(r => r.routeId === routeId);
            if (!route) {
                return {
                    routeId: routeId,
                    routeName: `Route ${routeId}`,
                    buses: [],
                    crowdLevel: 0,
                    trafficCondition: 'No Data'
                };
            }

            const currentTime = new Date().toLocaleTimeString('en-IN', { 
                timeZone: 'Asia/Kolkata',
                hour12: true 
            });
            
            const timings = route.timings || [];
            const activeBuses = [];
            
            timings.forEach((timing, index) => {
                const departureTime = timing;
                const eta = calculateETA(route.from, route.to, route, departureTime);
                
                if (currentTime >= departureTime && currentTime <= eta) {
                    const departureMinutes = timeToMinutes(departureTime);
                    const etaMinutes = timeToMinutes(eta);
                    const currentMinutes = timeToMinutes(currentTime);
                    
                    const totalDuration = etaMinutes - departureMinutes;
                    const elapsed = currentMinutes - departureMinutes;
                    const progress = Math.min(100, Math.max(0, (elapsed / totalDuration) * 100));
                    
                    activeBuses.push({
                        busId: `bus_${routeId}_${index + 1}`,
                        routeId: routeId,
                        status: progress > 90 ? 'arriving' : progress > 10 ? 'in-transit' : 'starting',
                        progress: Math.round(progress),
                        passengers: Math.floor(Math.random() * 40) + 10,
                        capacity: 60,
                        eta: eta,
                        currentStop: getCurrentStop(route, progress)
                    });
                }
            });

            return {
                routeId: routeId,
                routeName: route.name,
                buses: activeBuses,
                crowdLevel: Math.floor(Math.random() * 40) + 30,
                trafficCondition: ['Light', 'Moderate', 'Heavy'][Math.floor(Math.random() * 3)]
            };
        }

        function calculateETA(fromStop, toStop, route, departureTime) {
            if (!departureTime || departureTime === 'N/A') return 'N/A';
            
            const stops = route.stops;
            const fromIndex = stops.findIndex(stop => 
                stop.toLowerCase().includes(fromStop.toLowerCase())
            );
            const toIndex = stops.findIndex(stop => 
                stop.toLowerCase().includes(toStop.toLowerCase())
            );
            
            if (fromIndex === -1 || toIndex === -1) return 'N/A';
            
            const stopDifference = Math.abs(toIndex - fromIndex);
            const estimatedMinutes = stopDifference * 2;
            
            const departureDate = new Date();
            const [time, period] = departureTime.split(' ');
            const [hours, minutes] = time.split(':').map(Number);
            departureDate.setHours(period === 'PM' && hours !== 12 ? hours + 12 : hours, minutes, 0);
            
            const etaDate = new Date(departureDate.getTime() + estimatedMinutes * 60000);
            return etaDate.toLocaleTimeString('en-IN', { 
                timeZone: 'Asia/Kolkata',
                hour12: true 
            });
        }

        function timeToMinutes(timeStr) {
            const [time, period] = timeStr.split(' ');
            const [hours, minutes] = time.split(':').map(Number);
            let totalMinutes = hours * 60 + minutes;
            if (period === 'PM' && hours !== 12) totalMinutes += 12 * 60;
            if (period === 'AM' && hours === 12) totalMinutes = minutes;
            return totalMinutes;
        }

        function getCurrentStop(route, progress) {
            const stopIndex = Math.floor((progress / 100) * (route.stops.length - 1));
            return route.stops[Math.min(stopIndex, route.stops.length - 1)];
        }

        // Auto-run tests on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Test page loaded');
            setTimeout(() => {
                testDataSystem();
                testRoutePlanning();
                testLiveTracking();
            }, 1000);
        });
    </script>
</body>
</html>
